<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Enforcing constraints thru Constraint objects — Constraints • GenomicRanges</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Enforcing constraints thru Constraint objects — Constraints"><meta property="og:description" content='Attaching a Constraint object to an object of class A (the "constrained"
  object) is meant to be a convenient/reusable/extensible way to enforce
  a particular set of constraints on particular instances of A.
THIS IS AN EXPERIMENTAL FEATURE AND STILL VERY MUCH A WORK-IN-PROGRESS!'><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">GenomicRanges</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.51.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/GenomicRangesIntroduction.html">An Introduction to the GenomicRanges Package</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/Bioconductor/GenomicRanges/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Enforcing constraints thru Constraint objects</h1>
    
    <div class="hidden name"><code>constraint.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Attaching a Constraint object to an object of class A (the "constrained"
  object) is meant to be a convenient/reusable/extensible way to enforce
  a particular set of constraints on particular instances of A.</p>
<p>THIS IS AN EXPERIMENTAL FEATURE AND STILL VERY MUCH A WORK-IN-PROGRESS!</p>
    </div>


    <div id="details">
    <h2>Details</h2>
    <p>For the developer, using constraints is an alternative to the more
  traditional approach that consists in creating subclasses of A and
  implementing specific validity methods for each of them.
  However, using constraints offers the following advantages over the
  traditional approach:</p><ul><li><p>The traditional approach often tends to lead to a proliferation
          of subclasses of A.</p></li>
<li><p>Constraints can easily be re-used across different classes without
          the need to create any new class.</p></li>
<li><p>Constraints can easily be combined.</p></li>
</ul><p>All constraints are implemented as concrete subclasses of the Constraint
  class, which is a virtual class with no slots.
  Like the Constraint virtual class itself, concrete Constraint subclasses
  cannot have slots.</p>
<p>Here are the 7 steps typically involved in the process of putting
  constraints on objects of class A:</p><ol><li><p>Add a slot named <code>constraint</code> to the definition of class A.
          The type of this slot must be Constraint_OR_NULL. Note that
          any subclass of A will inherit this slot.</p></li>
<li><p>Implements the <code>constraint()</code> accessors (getter and setter)
          for objects of class A. This is done by implementing the
          <code>"constraint"</code> method (getter) and replacement method (setter)
          for objects of class A (see the examples below). As a convenience
          to the user, the setter should also accept the name of a constraint
          (i.e. the name of its class) in addition to an instance of that
          class. Note that those accessors will work on instances of any
          subclass of A.</p></li>
<li><p>Modify the validity method for class A so it also returns the
          result of <code>checkConstraint(x, constraint(x))</code> (append this
          result to the result returned by the validity method).</p></li>
<li><p>Testing: Create <code>x</code>, an instance of class A (or subclass of A).
          By default there is no constraint on it (<code>constraint(x)</code> is
          <code>NULL</code>). <code>validObject(x)</code> should return <code>TRUE</code>.</p></li>
<li><p>Create a new constraint (MyConstraint) by extending the
          Constraint class, typically with
          <code>setClass("MyConstraint", contains="Constraint")</code>.
          This constraint is not enforcing anything yet so you could put
          it on <code>x</code> (with <code>constraint(x) &lt;- "MyConstraint"</code>),
          but not much would happen. In order to actually enforce something,
          a <code>"checkConstraint"</code> method for signature
          <code>c(x="A", constraint="MyConstraint")</code> needs to be implemented.</p></li>
<li><p>Implement a <code>"checkConstraint"</code> method for signature
          <code>c(x="A", constraint="MyConstraint")</code>. Like validity methods,
          <code>"checkConstraint"</code> methods must return <code>NULL</code> or
          a character vector describing the problems found.
          Like validity methods, they should never fail (i.e. they should
          never raise an error).
          Note that, alternatively, an existing constraint (e.g.
          SomeConstraint) can be adapted to work on objects of class A
          by just defining a new <code>"checkConstraint"</code> method for
          signature <code>c(x="A", constraint="SomeConstraint")</code>.
          Also, stricter constraints can be built on top of existing
          constraints by extending one or more existing constraints
          (see the examples below).</p></li>
<li><p>Testing: Try <code>constraint(x) &lt;- "MyConstraint"</code>. It will or
          will not work depending on whether <code>x</code> satisfies the
          constraint or not. In the former case, trying to modify <code>x</code>
          in a way that breaks the constraint on it will also raise an
          error.</p></li>
</ol></div>
    <div id="note">
    <h2>Note</h2>
    <p>WARNING: This note is not true anymore as the <code>constraint</code> slot has
  been temporarily removed from <a href="GRanges-class.html">GenomicRanges</a> objects (starting with
  package GenomicRanges &gt;= 1.7.9).</p>
<p>Currently, only <a href="GRanges-class.html">GenomicRanges</a> objects can be constrained, that is:</p><ul><li><p>they have a <code>constraint</code> slot;</p></li>
<li><p>they have <code>constraint()</code> accessors (getter and setter)
          for this slot;</p></li>
<li><p>their validity method has been modified so it also returns the
          result of <code>checkConstraint(x, constraint(x))</code>.</p></li>
</ul><p>More classes in the GenomicRanges and IRanges packages will support
  constraints in the near future.</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>H. Pagès</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="https://rdrr.io/r/methods/setClass.html" class="external-link">setClass</a></code>,
  <code><a href="https://rdrr.io/r/methods/is.html" class="external-link">is</a></code>,
  <code><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></code>,
  <code><a href="https://rdrr.io/r/methods/showMethods.html" class="external-link">showMethods</a></code>,
  <code><a href="https://rdrr.io/r/methods/validObject.html" class="external-link">validObject</a></code>,
  <a href="GRanges-class.html">GenomicRanges-class</a></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## The examples below show how to define and set constraints on</span></span></span>
<span class="r-in"><span><span class="co">## GenomicRanges objects. Note that this is how the constraint()</span></span></span>
<span class="r-in"><span><span class="co">## setter is defined for GenomicRanges objects:</span></span></span>
<span class="r-in"><span><span class="co">#setReplaceMethod("constraint", "GenomicRanges",</span></span></span>
<span class="r-in"><span><span class="co">#    function(x, value)</span></span></span>
<span class="r-in"><span><span class="co">#    {</span></span></span>
<span class="r-in"><span><span class="co">#        if (isSingleString(value))</span></span></span>
<span class="r-in"><span><span class="co">#            value &lt;- new(value)</span></span></span>
<span class="r-in"><span><span class="co">#        if (!is(value, "Constraint_OR_NULL"))</span></span></span>
<span class="r-in"><span><span class="co">#            stop("the supplied 'constraint' must be a ",</span></span></span>
<span class="r-in"><span><span class="co">#                 "Constraint object, a single string, or NULL")</span></span></span>
<span class="r-in"><span><span class="co">#        x@constraint &lt;- value</span></span></span>
<span class="r-in"><span><span class="co">#        validObject(x)</span></span></span>
<span class="r-in"><span><span class="co">#        x</span></span></span>
<span class="r-in"><span><span class="co">#    }</span></span></span>
<span class="r-in"><span><span class="co">#)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#selectMethod("constraint", "GenomicRanges")  # the getter</span></span></span>
<span class="r-in"><span><span class="co">#selectMethod("constraint&lt;-", "GenomicRanges")  # the setter</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## We'll use the GRanges instance 'gr' created in the GRanges examples</span></span></span>
<span class="r-in"><span><span class="co">## to test our constraints:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/example.html" class="external-link">example</a></span><span class="op">(</span><span class="va">GRanges</span>, echo<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Class "GRanges" [package "GenomicRanges"]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Slots:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                                                       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Name:         seqnames          ranges          strand         seqinfo</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Class:             Rle IRanges_OR_IPos             Rle         Seqinfo</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                                       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Name:  elementMetadata     elementType        metadata</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Class:       DataFrame       character            list</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Extends: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Class "GenomicRanges", directly</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Class "GRanges_OR_NULL", directly</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Class "Ranges", by class "GenomicRanges", distance 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Class "GenomicRanges_OR_missing", by class "GenomicRanges", distance 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Class "GenomicRanges_OR_GenomicRangesList", by class "GenomicRanges", distance 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Class "GenomicRanges_OR_GRangesList", by class "GenomicRanges", distance 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Class "List", by class "GenomicRanges", distance 3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Class "Vector", by class "GenomicRanges", distance 4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Class "list_OR_List", by class "GenomicRanges", distance 4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Class "Annotated", by class "GenomicRanges", distance 5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Class "vector_OR_Vector", by class "GenomicRanges", distance 5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Known Subclasses: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Class "GPos", directly</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Class "UnstitchedGPos", by class "GPos", distance 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Class "StitchedGPos", by class "GPos", distance 2</span>
<span class="r-in"><span><span class="va">gr</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> GRanges object with 10 ranges and 2 metadata columns:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     seqnames    ranges strand |     score        GC</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt; | &lt;integer&gt; &lt;numeric&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   a     chr2      1-10      - |         1  1.000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   b     chr2      2-10      + |         2  0.888889</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   c     chr2      3-10      + |         3  0.777778</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   d     chr2      4-10      * |         4  0.666667</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   e     chr1      5-10      * |         5  0.555556</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   f     chr1      6-10      + |         6  0.444444</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   g     chr3      7-10      + |         7  0.333333</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   h     chr3      8-10      + |         8  0.222222</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   i     chr3      9-10      - |         9  0.111111</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   j     chr3        10      - |        10  0.000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   seqinfo: 3 sequences from mock1 genome</span>
<span class="r-in"><span><span class="co">#constraint(gr)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ---------------------------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## EXAMPLE 1: The HasRangeTypeCol constraint.</span></span></span>
<span class="r-in"><span><span class="co">## ---------------------------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## The HasRangeTypeCol constraint checks that the constrained object</span></span></span>
<span class="r-in"><span><span class="co">## has a unique "rangeType" metadata column and that this column</span></span></span>
<span class="r-in"><span><span class="co">## is a 'factor' Rle with no NAs and with the following levels</span></span></span>
<span class="r-in"><span><span class="co">## (in this order): gene, transcript, exon, cds, 5utr, 3utr.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/methods/setClass.html" class="external-link">setClass</a></span><span class="op">(</span><span class="st">"HasRangeTypeCol"</span>, contains<span class="op">=</span><span class="st">"Constraint"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Like validity methods, "checkConstraint" methods must return NULL or</span></span></span>
<span class="r-in"><span><span class="co">## a character vector describing the problems found. They should never</span></span></span>
<span class="r-in"><span><span class="co">## fail i.e. they should never raise an error.</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"checkConstraint"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GenomicRanges"</span>, <span class="st">"HasRangeTypeCol"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">constraint</span>, <span class="va">verbose</span><span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">{</span></span></span>
<span class="r-in"><span>        <span class="va">x_mcols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">mcols</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span>        <span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/match.html" class="external-link">match</a></span><span class="op">(</span><span class="st">"rangeType"</span>, <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">x_mcols</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">idx</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">1L</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">idx</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>            <span class="va">msg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"'mcols(x)' must have exactly 1 column "</span>,</span></span>
<span class="r-in"><span>                     <span class="st">"named \"rangeType\""</span><span class="op">)</span></span></span>
<span class="r-in"><span>            <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">msg</span>, collapse<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>        <span class="op">}</span></span></span>
<span class="r-in"><span>        <span class="va">rangeType</span> <span class="op">&lt;-</span> <span class="va">x_mcols</span><span class="op">[[</span><span class="va">idx</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span>        <span class="va">.LEVELS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gene"</span>, <span class="st">"transcript"</span>, <span class="st">"exon"</span>, <span class="st">"cds"</span>, <span class="st">"5utr"</span>, <span class="st">"3utr"</span><span class="op">)</span></span></span>
<span class="r-in"><span>        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/methods/is.html" class="external-link">is</a></span><span class="op">(</span><span class="va">rangeType</span>, <span class="st">"Rle"</span><span class="op">)</span> <span class="op">||</span></span></span>
<span class="r-in"><span>            <span class="fu">S4Vectors</span><span class="fu">:::</span><span class="fu">anyMissing</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Rle-class.html" class="external-link">runValue</a></span><span class="op">(</span><span class="va">rangeType</span><span class="op">)</span><span class="op">)</span> <span class="op">||</span></span></span>
<span class="r-in"><span>            <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Factor-class.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">rangeType</span><span class="op">)</span>, <span class="va">.LEVELS</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>        <span class="op">{</span></span></span>
<span class="r-in"><span>            <span class="va">msg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"'mcols(x)$rangeType' must be a "</span>,</span></span>
<span class="r-in"><span>                     <span class="st">"'factor' Rle with no NAs and with levels: "</span>,</span></span>
<span class="r-in"><span>                     <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">.LEVELS</span>, collapse<span class="op">=</span><span class="st">", "</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>            <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">msg</span>, collapse<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>        <span class="op">}</span></span></span>
<span class="r-in"><span>        <span class="cn">NULL</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#\dontrun{</span></span></span>
<span class="r-in"><span><span class="co">#constraint(gr) &lt;- "HasRangeTypeCol"  # will fail</span></span></span>
<span class="r-in"><span><span class="co">#}</span></span></span>
<span class="r-in"><span><span class="fu">checkConstraint</span><span class="op">(</span><span class="va">gr</span>, <span class="fu"><a href="https://rdrr.io/r/methods/new.html" class="external-link">new</a></span><span class="op">(</span><span class="st">"HasRangeTypeCol"</span><span class="op">)</span><span class="op">)</span>  <span class="co"># with GenomicRanges &gt;= 1.7.9</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "'mcols(x)' must have exactly 1 column named \"rangeType\""</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">levels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gene"</span>, <span class="st">"transcript"</span>, <span class="st">"exon"</span>, <span class="st">"cds"</span>, <span class="st">"5utr"</span>, <span class="st">"3utr"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rangeType</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Rle-class.html" class="external-link">Rle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cds"</span>, <span class="st">"gene"</span><span class="op">)</span>, levels<span class="op">=</span><span class="va">levels</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">mcols</a></span><span class="op">(</span><span class="va">gr</span><span class="op">)</span><span class="op">$</span><span class="va">rangeType</span> <span class="op">&lt;-</span> <span class="va">rangeType</span></span></span>
<span class="r-in"><span><span class="co">#constraint(gr) &lt;- "HasRangeTypeCol"  # OK</span></span></span>
<span class="r-in"><span><span class="fu">checkConstraint</span><span class="op">(</span><span class="va">gr</span>, <span class="fu"><a href="https://rdrr.io/r/methods/new.html" class="external-link">new</a></span><span class="op">(</span><span class="st">"HasRangeTypeCol"</span><span class="op">)</span><span class="op">)</span>  <span class="co"># with GenomicRanges &gt;= 1.7.9</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Use is() to check whether the object has a given constraint or not:</span></span></span>
<span class="r-in"><span><span class="co">#is(constraint(gr), "HasRangeTypeCol")  # TRUE</span></span></span>
<span class="r-in"><span><span class="co">#\dontrun{</span></span></span>
<span class="r-in"><span><span class="co">#mcols(gr)$rangeType[3] &lt;- NA  # will fail</span></span></span>
<span class="r-in"><span><span class="co">#}</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">mcols</a></span><span class="op">(</span><span class="va">gr</span><span class="op">)</span><span class="op">$</span><span class="va">rangeType</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span></span>
<span class="r-in"><span><span class="fu">checkConstraint</span><span class="op">(</span><span class="va">gr</span>, <span class="fu"><a href="https://rdrr.io/r/methods/new.html" class="external-link">new</a></span><span class="op">(</span><span class="st">"HasRangeTypeCol"</span><span class="op">)</span><span class="op">)</span>  <span class="co"># with GenomicRanges &gt;= 1.7.9</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "'mcols(x)$rangeType' must be a 'factor' Rle with no NAs and with levels: gene, transcript, exon, cds, 5utr, 3utr"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ---------------------------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## EXAMPLE 2: The GeneRanges constraint.</span></span></span>
<span class="r-in"><span><span class="co">## ---------------------------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## The GeneRanges constraint is defined on top of the HasRangeTypeCol</span></span></span>
<span class="r-in"><span><span class="co">## constraint. It checks that all the ranges in the object are of type</span></span></span>
<span class="r-in"><span><span class="co">## "gene".</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/methods/setClass.html" class="external-link">setClass</a></span><span class="op">(</span><span class="st">"GeneRanges"</span>, contains<span class="op">=</span><span class="st">"HasRangeTypeCol"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The checkConstraint() generic will check the HasRangeTypeCol constraint</span></span></span>
<span class="r-in"><span><span class="co">## first, and, only if it's statisfied, it will then check the GeneRanges</span></span></span>
<span class="r-in"><span><span class="co">## constraint.</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"checkConstraint"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GenomicRanges"</span>, <span class="st">"GeneRanges"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">constraint</span>, <span class="va">verbose</span><span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">{</span></span></span>
<span class="r-in"><span>        <span class="va">rangeType</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">mcols</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">$</span><span class="va">rangeType</span></span></span>
<span class="r-in"><span>        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">rangeType</span> <span class="op">==</span> <span class="st">"gene"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>            <span class="va">msg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"all elements in 'mcols(x)$rangeType' "</span>,</span></span>
<span class="r-in"><span>                     <span class="st">"must be equal to \"gene\""</span><span class="op">)</span></span></span>
<span class="r-in"><span>            <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">msg</span>, collapse<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>        <span class="op">}</span></span></span>
<span class="r-in"><span>        <span class="cn">NULL</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#\dontrun{</span></span></span>
<span class="r-in"><span><span class="co">#constraint(gr) &lt;- "GeneRanges"  # will fail</span></span></span>
<span class="r-in"><span><span class="co">#}</span></span></span>
<span class="r-in"><span><span class="fu">checkConstraint</span><span class="op">(</span><span class="va">gr</span>, <span class="fu"><a href="https://rdrr.io/r/methods/new.html" class="external-link">new</a></span><span class="op">(</span><span class="st">"GeneRanges"</span><span class="op">)</span><span class="op">)</span>  <span class="co"># with GenomicRanges &gt;= 1.7.9</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "all elements in 'mcols(x)$rangeType' must be equal to \"gene\""</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">mcols</a></span><span class="op">(</span><span class="va">gr</span><span class="op">)</span><span class="op">$</span><span class="va">rangeType</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"gene"</span></span></span>
<span class="r-in"><span><span class="co">## This replace the previous constraint (HasRangeTypeCol):</span></span></span>
<span class="r-in"><span><span class="co">#constraint(gr) &lt;- "GeneRanges"  # OK</span></span></span>
<span class="r-in"><span><span class="fu">checkConstraint</span><span class="op">(</span><span class="va">gr</span>, <span class="fu"><a href="https://rdrr.io/r/methods/new.html" class="external-link">new</a></span><span class="op">(</span><span class="st">"GeneRanges"</span><span class="op">)</span><span class="op">)</span>  <span class="co"># with GenomicRanges &gt;= 1.7.9</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#is(constraint(gr), "GeneRanges")  # TRUE</span></span></span>
<span class="r-in"><span><span class="co">## However, 'gr' still indirectly has the HasRangeTypeCol constraint</span></span></span>
<span class="r-in"><span><span class="co">## (because the GeneRanges constraint extends the HasRangeTypeCol</span></span></span>
<span class="r-in"><span><span class="co">## constraint):</span></span></span>
<span class="r-in"><span><span class="co">#is(constraint(gr), "HasRangeTypeCol")  # TRUE</span></span></span>
<span class="r-in"><span><span class="co">#\dontrun{</span></span></span>
<span class="r-in"><span><span class="co">#mcols(gr)$rangeType[] &lt;- "exon"  # will fail</span></span></span>
<span class="r-in"><span><span class="co">#}</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">mcols</a></span><span class="op">(</span><span class="va">gr</span><span class="op">)</span><span class="op">$</span><span class="va">rangeType</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"exon"</span></span></span>
<span class="r-in"><span><span class="fu">checkConstraint</span><span class="op">(</span><span class="va">gr</span>, <span class="fu"><a href="https://rdrr.io/r/methods/new.html" class="external-link">new</a></span><span class="op">(</span><span class="st">"GeneRanges"</span><span class="op">)</span><span class="op">)</span>  <span class="co"># with GenomicRanges &gt;= 1.7.9</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "all elements in 'mcols(x)$rangeType' must be equal to \"gene\""</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ---------------------------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## EXAMPLE 3: The HasGCCol constraint.</span></span></span>
<span class="r-in"><span><span class="co">## ---------------------------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## The HasGCCol constraint checks that the constrained object has a</span></span></span>
<span class="r-in"><span><span class="co">## unique "GC" metadata column, that this column is of type numeric,</span></span></span>
<span class="r-in"><span><span class="co">## with no NAs, and that all the values in that column are &gt;= 0 and &lt;= 1.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/methods/setClass.html" class="external-link">setClass</a></span><span class="op">(</span><span class="st">"HasGCCol"</span>, contains<span class="op">=</span><span class="st">"Constraint"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"checkConstraint"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GenomicRanges"</span>, <span class="st">"HasGCCol"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">constraint</span>, <span class="va">verbose</span><span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">{</span></span></span>
<span class="r-in"><span>        <span class="va">x_mcols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">mcols</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span>        <span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/match.html" class="external-link">match</a></span><span class="op">(</span><span class="st">"GC"</span>, <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">x_mcols</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">idx</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">1L</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">idx</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>            <span class="va">msg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"'mcols(x)' must have exactly "</span>,</span></span>
<span class="r-in"><span>                     <span class="st">"one column named \"GC\""</span><span class="op">)</span></span></span>
<span class="r-in"><span>            <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">msg</span>, collapse<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>        <span class="op">}</span></span></span>
<span class="r-in"><span>        <span class="va">GC</span> <span class="op">&lt;-</span> <span class="va">x_mcols</span><span class="op">[[</span><span class="va">idx</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span>        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">GC</span><span class="op">)</span> <span class="op">||</span></span></span>
<span class="r-in"><span>            <span class="fu">S4Vectors</span><span class="fu">:::</span><span class="fu">anyMissing</span><span class="op">(</span><span class="va">GC</span><span class="op">)</span> <span class="op">||</span></span></span>
<span class="r-in"><span>            <span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">GC</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">GC</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>        <span class="op">{</span></span></span>
<span class="r-in"><span>            <span class="va">msg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"'mcols(x)$GC' must be a numeric vector "</span>,</span></span>
<span class="r-in"><span>                     <span class="st">"with no NAs and with values between 0 and 1"</span><span class="op">)</span></span></span>
<span class="r-in"><span>            <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">msg</span>, collapse<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>        <span class="op">}</span></span></span>
<span class="r-in"><span>        <span class="cn">NULL</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## This replace the previous constraint (GeneRanges):</span></span></span>
<span class="r-in"><span><span class="co">#constraint(gr) &lt;- "HasGCCol"  # OK</span></span></span>
<span class="r-in"><span><span class="fu">checkConstraint</span><span class="op">(</span><span class="va">gr</span>, <span class="fu"><a href="https://rdrr.io/r/methods/new.html" class="external-link">new</a></span><span class="op">(</span><span class="st">"HasGCCol"</span><span class="op">)</span><span class="op">)</span>  <span class="co"># with GenomicRanges &gt;= 1.7.9</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#is(constraint(gr), "HasGCCol")  # TRUE</span></span></span>
<span class="r-in"><span><span class="co">#is(constraint(gr), "GeneRanges")  # FALSE</span></span></span>
<span class="r-in"><span><span class="co">#is(constraint(gr), "HasRangeTypeCol")  # FALSE</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ---------------------------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## EXAMPLE 4: The HighGCRanges constraint.</span></span></span>
<span class="r-in"><span><span class="co">## ---------------------------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## The HighGCRanges constraint is defined on top of the HasGCCol</span></span></span>
<span class="r-in"><span><span class="co">## constraint. It checks that all the ranges in the object have a GC</span></span></span>
<span class="r-in"><span><span class="co">## content &gt;= 0.5.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/methods/setClass.html" class="external-link">setClass</a></span><span class="op">(</span><span class="st">"HighGCRanges"</span>, contains<span class="op">=</span><span class="st">"HasGCCol"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The checkConstraint() generic will check the HasGCCol constraint</span></span></span>
<span class="r-in"><span><span class="co">## first, and, if it's statisfied, it will then check the HighGCRanges</span></span></span>
<span class="r-in"><span><span class="co">## constraint.</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"checkConstraint"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GenomicRanges"</span>, <span class="st">"HighGCRanges"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">constraint</span>, <span class="va">verbose</span><span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">{</span></span></span>
<span class="r-in"><span>        <span class="va">GC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">mcols</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">$</span><span class="va">GC</span></span></span>
<span class="r-in"><span>        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">GC</span> <span class="op">&gt;=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>            <span class="va">msg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"all elements in 'mcols(x)$GC' "</span>,</span></span>
<span class="r-in"><span>                     <span class="st">"must be &gt;= 0.5"</span><span class="op">)</span></span></span>
<span class="r-in"><span>            <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">msg</span>, collapse<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>        <span class="op">}</span></span></span>
<span class="r-in"><span>        <span class="cn">NULL</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#\dontrun{</span></span></span>
<span class="r-in"><span><span class="co">#constraint(gr) &lt;- "HighGCRanges"  # will fail</span></span></span>
<span class="r-in"><span><span class="co">#}</span></span></span>
<span class="r-in"><span><span class="fu">checkConstraint</span><span class="op">(</span><span class="va">gr</span>, <span class="fu"><a href="https://rdrr.io/r/methods/new.html" class="external-link">new</a></span><span class="op">(</span><span class="st">"HighGCRanges"</span><span class="op">)</span><span class="op">)</span>  <span class="co"># with GenomicRanges &gt;= 1.7.9</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "all elements in 'mcols(x)$GC' must be &gt;= 0.5"</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">mcols</a></span><span class="op">(</span><span class="va">gr</span><span class="op">)</span><span class="op">$</span><span class="va">GC</span><span class="op">[</span><span class="fl">6</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span></span>
<span class="r-in"><span><span class="co">#constraint(gr) &lt;- "HighGCRanges"  # OK</span></span></span>
<span class="r-in"><span><span class="fu">checkConstraint</span><span class="op">(</span><span class="va">gr</span>, <span class="fu"><a href="https://rdrr.io/r/methods/new.html" class="external-link">new</a></span><span class="op">(</span><span class="st">"HighGCRanges"</span><span class="op">)</span><span class="op">)</span>  <span class="co"># with GenomicRanges &gt;= 1.7.9</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#is(constraint(gr), "HighGCRanges")  # TRUE</span></span></span>
<span class="r-in"><span><span class="co">#is(constraint(gr), "HasGCCol")  # TRUE</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ---------------------------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## EXAMPLE 5: The HighGCGeneRanges constraint.</span></span></span>
<span class="r-in"><span><span class="co">## ---------------------------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## The HighGCGeneRanges constraint is the combination (AND) of the</span></span></span>
<span class="r-in"><span><span class="co">## GeneRanges and HighGCRanges constraints.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/methods/setClass.html" class="external-link">setClass</a></span><span class="op">(</span><span class="st">"HighGCGeneRanges"</span>, contains<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GeneRanges"</span>, <span class="st">"HighGCRanges"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## No need to define a method for this constraint: the checkConstraint()</span></span></span>
<span class="r-in"><span><span class="co">## generic will automatically check the GeneRanges and HighGCRanges</span></span></span>
<span class="r-in"><span><span class="co">## constraints.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#constraint(gr) &lt;- "HighGCGeneRanges"  # OK</span></span></span>
<span class="r-in"><span><span class="fu">checkConstraint</span><span class="op">(</span><span class="va">gr</span>, <span class="fu"><a href="https://rdrr.io/r/methods/new.html" class="external-link">new</a></span><span class="op">(</span><span class="st">"HighGCGeneRanges"</span><span class="op">)</span><span class="op">)</span>  <span class="co"># with GenomicRanges &gt;= 1.7.9</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "all elements in 'mcols(x)$rangeType' must be equal to \"gene\""</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#is(constraint(gr), "HighGCGeneRanges")  # TRUE</span></span></span>
<span class="r-in"><span><span class="co">#is(constraint(gr), "HighGCRanges")  # TRUE</span></span></span>
<span class="r-in"><span><span class="co">#is(constraint(gr), "HasGCCol")  # TRUE</span></span></span>
<span class="r-in"><span><span class="co">#is(constraint(gr), "GeneRanges")  # TRUE</span></span></span>
<span class="r-in"><span><span class="co">#is(constraint(gr), "HasRangeTypeCol")  # TRUE</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## See how all the individual constraints are checked (from less</span></span></span>
<span class="r-in"><span><span class="co">## specific to more specific constraints):</span></span></span>
<span class="r-in"><span><span class="co">#checkConstraint(gr, constraint(gr), verbose=TRUE)</span></span></span>
<span class="r-in"><span><span class="fu">checkConstraint</span><span class="op">(</span><span class="va">gr</span>, <span class="fu"><a href="https://rdrr.io/r/methods/new.html" class="external-link">new</a></span><span class="op">(</span><span class="st">"HighGCGeneRanges"</span><span class="op">)</span>, verbose<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>  <span class="co"># with</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "all elements in 'mcols(x)$rangeType' must be equal to \"gene\""</span>
<span class="r-in"><span>                                                            <span class="co"># GenomicRanges</span></span></span>
<span class="r-in"><span>                                                            <span class="co"># &gt;= 1.7.9</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## See all the "checkConstraint" methods:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/methods/showMethods.html" class="external-link">showMethods</a></span><span class="op">(</span><span class="st">"checkConstraint"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Function: checkConstraint (package GenomicRanges)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x="ANY", constraint="ANY"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x="GRanges", constraint="HighGCGeneRanges"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     (inherited from: x="GenomicRanges", constraint="GeneRanges")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x="GRanges", constraint="HighGCRanges"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     (inherited from: x="GenomicRanges", constraint="HighGCRanges")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x="GenomicRanges", constraint="GeneRanges"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x="GenomicRanges", constraint="HasGCCol"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x="GenomicRanges", constraint="HasRangeTypeCol"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x="GenomicRanges", constraint="HighGCRanges"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Patrick Aboyoun, Hervé Pagès, Michael Lawrence.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

